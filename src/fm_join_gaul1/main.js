define(['jquery',
    'handlebars',
    'text!fm_join_gaul1/html/template.html',
    'fenix-map'], function ($, Handlebars, template) {

    'use strict';

    function FM_JOIN_GAUL1() {
        this.o = {
            'lang': 'en',
            'placeholder': 'main_content'
        };
    }

    FM_JOIN_GAUL1.prototype.init = function(config) {
        this.o = $.extend(true, {}, this.o, config);
        var source = $(template).filter('#template').html();
        var t = Handlebars.compile(source);
        var html = t();
        $('#' + this.o.placeholder).html(html);

        // map
        var m = new FM.Map('map', {
            plugins: {
                geosearch: true,
                mouseposition: false,
                controlloading : true,
                zoomControl: 'bottomright'
            },
            guiController: {
                overlay: true,
                baselayer: true,
                wmsLoader: true
            },
            gui: {
                disclaimerfao: true
            }
        }, {
            zoomControl: false,
            attributionControl: false
        });
        m.createMap();
        m.map.fitBounds([[45.5231189727783, 68.1863842010498], [-11.0074806213379, 153.984685897827]]);

        var joincolumnlabel = 'adm1_name';
        var joincolumn =  'adm1_code';
        var mu =  '&#37;';
        var data = [{2851:0.3890407849913058},{1484:0.0},{1485:0.14587320634043877},{3326:1.1779763193234154},{2852:0.9302563071250916},{898:0.16676137293681098},{65290:0.006531819235533476},{70072:0.03314925647519399},{1487:0.32998849673955527},{2126:0.6343060518149286},{3329:0.32832962013180217},{3328:0.053023914221483164},{3330:0.4800397265288565},{3331:0.9728243827819825},{41772:0.2582967267911984},{41773:0.31295659073761534},{1513:0.27569127714054453},{73609:0.008915747770653019},{2853:0.17234909627586603},{791:0.2410633740265195},{73610:0.46284970617853105},{3327:0.13429037960512297},{575:1.161935133429674},{792:0.14192057833573674},{899:0.008880215552881982},{1514:0.05532403657240654},{3332:0.5400158800184727},{70073:0.365643781835995},{3333:0.1268453442802032},{3334:0.1365749561227858},{3335:0.15187414127091567},{3336:0.10674026335843585},{2854:0.4189308677386079},{3339:0.33006528827051324},{73933:0.7452339380979538},{3338:0.04834749282484776},{2855:0.32820274386751025},{2856:0.9197667360305786},{2857:0.13521629769583138},{70074:0.1530473679304123},{2858:0.031712847306056224},{70075:0.22873023134937542},{2859:0.036804911760425954},{2860:0.14849361156772697},{2125:0.011629518357092838},{576:0.5569711034572625},{2861:0.0732613573782146},{900:0.0971327385780346},{2862:0.030238241632469},{70076:0.16983502606550852},{1515:0.34948827732693066},{73934:0.020257028837134983},{73935:0.013474131230678824},{70077:0.0},{3340:0.3857187256217003},{1489:0.04925856385186004},{577:0.8754057094094253},{73936:0.016538141083214688},{1516:0.09636071813292801},{3342:0.06049511727604379},{3343:1.33341820343681},{901:0.11581291568427332},{902:0.0004992336282731202},{3344:0.03101025382638909},{1490:0.2755943821477039},{73611:0.029260089919890885},{903:0.14669894695784416},{904:0.0990626767182251},{905:0.04222356139200902},{1491:0.02656723947388442},{3345:0.020108804374103784},{3350:0.31277590841054914},{906:0.0989795786888516},{3351:0.8666307270526886},{3346:1.0427417516708375},{3347:0.7822257354855537},{1492:0.24822606257096672},{3348:0.49319594022300506},{3349:0.18626736754297532},{73937:0.6023210659623146},{907:0.008714180792641475},{908:0.015594295475529674},{909:0.029954988654193142},{1493:0.01627714609469287},{3353:0.14165425755911404},{3352:0.36767878180200403},{911:0.12866606975009773},{912:0.19492377156444193},{3354:1.1323113441467285},{1518:0.04118415905824783},{73613:0.4881956050734198},{1520:0.46475987620811604},{1521:0.35929890881528914},{70078:0.21686961051697531},{913:0.23892442775968067},{914:0.18255433899819917},{915:0.022904845022389566},{2127:0.01875112119478037},{2863:0.30397417590022086},{1522:0.03754541130922608},{1523:0.10984840009768959},{1524:0.01910794220046279},{1525:0.008648766307649752},{2864:0.2996968883164828},{793:0.18714253723566585},{794:0.17541333260014652},{795:0.12429013905324499},{796:0.08941620731544074},{797:0.3222522829370252},{2865:0.04852545284499813},{798:0.24312730729579926},{1494:0.07037464250468387},{2129:0.02608863567761348},{2128:0.0651305613777878},{73614:0.011023204445853087},{1495:0.08451294097343987},{3355:0.1263948724915584},{2866:0.28302914909540844},{578:0.7303578446796335},{3356:0.6530189891887266},{799:0.03163717416125934},{3357:0.024335631475384745},{2867:0.03406929788179695},{801:0.021665636803359225},{73938:0.02438174507741888},{3359:0.028158345732136048},{2868:0.056260728107493684},{2869:0.050864815705322794},{1526:0.13556683192176647},{3360:0.049071837186573014},{73939:0.02695217244707657},{916:0.02982109714274117},{2870:0.07214633658086547},{3362:1.0395785154718342},{2871:0.29541237584569235},{70079:0.05701595024119671},{2872:0.010500530259029821},{2130:0.0517632101613706},{1498:0.04697777327712601},{2873:0.4702300988137722},{73615:0.0004861912145204567},{73616:0.0013667887550780603},{2131:0.08660236104459425},{1500:0.07717894883809676},{1501:0.05571263973686974},{1502:0.050312348700672214},{2132:0.3395594090626046},{803:0.01153179550750124},{2874:0.263625406101346},{1503:0.008097420751084059},{2875:0.36143682964823465},{2876:0.4877506116261849},{2877:0.16997936057547727},{2878:0.24116287681440643},{2879:0.43386321841445685},{2880:0.11223487058388336},{3364:1.0971093823512394},{2881:0.052322151858566535},{1512:0.059794329408512335},{2882:0.03967615554173445},{917:0.000785006189445478},{3366:0.11471195376409432},{918:0.009823343305930158},{3367:0.8436288183761967},{3368:0.10823526326566935},{2883:0.07952419629898565},{2884:0.21487887672936687},{2885:0.7162161469459534},{1528:0.15445903478726997},{1529:0.040489764629624954},{1504:0.30548632858812497},{804:0.06372952051064436},{805:0.08315468352520838},{73617:0.00022755684911567804},{73612:0.0004670152539151204},{2886:0.6324857638941871},{2887:0.162442954426462},{2888:0.18831775965435163},{2889:0.007250842355036488},{2890:0.20111073791980744},{2891:0.13702109004655966},{2892:0.15093685926071235},{2893:0.12078131172096446},{2894:0.6914545893669128},{2895:0.2564481815070282},{806:0.5136359930038452},{2897:0.06775852870813819},{2896:0.7121704587569604},{2898:0.016825199592858553},{3369:0.18656927877320692},{3370:0.15078605062195233},{2899:0.022375370148273014},{802:0.18895645532757044},{807:0.015148979240038898},{808:0.5042677387595177},{70080:0.35427626222372055},{1505:0.47355912606287587},{809:0.10893728993833066},{919:4.2362011395666025e-09},{3371:0.07489185352205184},{3372:0.07180664167390205},{3374:0.2024730053996401},{3375:0.10961074780586154},{3376:0.1088902969204355},{1506:0.004781437252599451},{61362:0.8876576654210284},{2123:0.12255886290410173},{61363:0.927580979659403},{2900:0.019072542898356915},{810:0.018957634820626713},{2901:0.1652948578718949},{2902:0.01730291091877481},{73618:0.019008217700625173},{2903:0.502347964545091},{2133:0.021226411165737705},{2904:0.2292529372125864},{2905:0.26544602939652073},{2906:0.15866002440452576},{2907:0.09346106808100428},{2908:0.1571237031991283},{2909:0.26251862190950376},{2910:0.05384949760304557},{920:0.007727107787298368},{921:0.010763852853947008},{41774:0.0341785818040784},{922:0.30230834815435875},{41775:0.027880812192658293},{41776:0.019934605410687246},{923:0.0007548232927208414},{924:0.04369677855136391},{811:0.045632172343033885},{1507:0.01831124260397855},{2912:1.0361843307813008},{2911:0.4035283609991893},{3377:1.0930433471997578},{2913:0.08605727915548617},{3378:0.028767662942996836},{812:0.013847473015344251},{2914:0.2147416089102626},{73619:0.04780834104429494},{73620:0.14613490191839854},{1532:0.027795922290533782},{1533:0.02494997464695034},{73621:0.04103949700032225},{1535:0.10094705325817423},{73622:0.050217357505245704},{1537:0.09985530844182079},{2915:0.5493257530033588},{2916:0.02084352040002423},{2917:0.5004753528628498},{813:0.5715471483767033},{580:0.8042392396174445},{2918:0.028377516760056922},{814:0.598705075003884},{1508:0.17226533517837966},{2135:0.026484718182311153},{3379:0.20147239472027179},{3380:1.1230477624469333},{3381:0.29518552468373227},{3382:0.2539355199466028},{3383:0.09222471446264535},{926:0.04239048958632664},{3384:0.7039257235386792},{2919:0.028963041271230106},{2920:0.03567715511927681},{3386:1.197632944583893},{1509:0.18099525298287228},{3387:0.08063677765746066},{2921:0.3521129935647228},{2922:0.09839504547417163},{2923:0.39029274179357226},{2924:0.12247373049956609},{70082:0.04583802489973377},{70081:0.2210957063442461},{3388:1.4444791674613953},{3389:0.252635867231422},{1511:0.6996634812397964},{927:0.0002780310281249895},{928:1.1509716183762412e-05},{2925:0.02761636081462105},{2136:0.6287516952595777},{2926:0.37962546271662556},{3390:0.06818074731261663},{929:0.023980253905863273},{930:0.2005439134369995},{1651:0.051669483166188},{1652:0.07405272191933084},{1653:0.05269309321662322},{1753:0.014606789165340802},{1754:0.026022995364459633},{1755:0.03689394513580215},{2152:0.16690649303103175},{1756:0.05535775806045655},{2153:0.1717336429232091},{1654:0.03423706899047829},{2154:0.0643833356885311},{1658:0.025009032913658302},{1659:0.03406839122596596},{1660:0.032849470793033936},{1661:0.017169162680151194},{1757:0.015760104111556775},{1655:0.05316744210492624},{1656:0.08830120390262075},{1657:0.06984541628927249},{1662:0.05248748282504427},{1663:0.14692278540072343},{1664:0.0635954615870668},{1665:0.03652201824766284},{1666:0.10952729539712891},{1667:0.034187027909071514},{1668:0.017729301737355336},{1758:0.028201235160748992},{1669:0.021032598823768314},{1670:0.0771346322618998},{1671:0.04625642480689804},{1760:0.018081030362382434},{1759:0.01813369169223247},{2155:0.032729917295947424},{1672:0.05872479467372479},{1673:0.10560765077471969},{1674:0.03203780797614147},{1675:0.02955693810894017},{1676:0.057653818957545365},{1677:0.0283137305307069},{1678:0.08697520952693094},{1680:0.055225891698177695},{1681:0.0026911467236156263},{1679:0.041622471545775565},{1682:0.02933682904889186},{1761:0.01995659911398948},{1762:0.02071105793196087},{1683:0.126528655923903},{1684:0.06296295376960188},{1763:0.045563246790521046},{1764:0.056656959288759356},{1685:0.10443054219811326},{1686:0.03455326209835235},{1687:0.02083260155165062},{1693:0.12026502032114088},{1689:0.035302767280216626},{1690:0.014472724861116148},{1688:0.11037425338016714},{1691:0.0501323611750148},{1692:0.08787879803339424},{74346:0.03084425503766397},{1768:0.15326248391948896},{1694:0.019241699392626866},{2156:0.09909630818077073},{1765:0.01982529132219497},{1766:0.008872632433373768},{74347:0.012309452875342686},{1695:0.07017249552617696},{1696:0.047469478671164175},{1697:0.015622941949202315},{67156:0.1359684140770696},{2354:0.058372796701459104},{1891:0.0006180931922308234},{1892:0.1507474934934812},{1893:0.03540128795042013},{1895:0.004217672098258679},{2355:0.09737767186015844},{1896:0.0011172940980031854},{1897:0.001064164624568225},{1898:0.027063828648214727},{1899:0.04571327567100525},{1900:0.22212261855602264},{2357:0.18087887767337493},{67165:0.26740940976287086},{2356:0.2582273435863582},{67166:0.09390094214203683},{67167:0.09992622170830145},{67159:0.10496154656927836},{2361:0.18483402617275715},{2363:0.0697634727588262},{2364:0.11298803949769395},{2362:0.2793419354573916},{67161:0.05662142677877949},{2368:0.06235153430966827},{67162:0.16573507782931512},{67160:0.07658992713162055},{1901:0.047357688850796144},{1902:0.002649291342592887},{1903:0.032292517332179055},{1904:0.010077779986842096},{1054:0.017418899090085743},{2431:0.18821893403163323},{2432:0.16546125370418516},{2433:0.1897995300913373},{2434:0.10008186530903913},{2435:0.16987843407152953},{1058:0.02546686421447336},{1062:0.025469453351191936},{1059:0.09299179954834325},{1063:0.1419676420175367},{1055:0.12526981559182918},{2437:0.03612240234192891},{1056:0.03720865058084388},{2438:0.1120234988629818},{2439:0.0941602252679877},{2440:0.1001512475614375},{2441:0.10956844016738715},{2442:0.09948137775063515},{1060:0.0470698812795389},{1064:0.06703569213680637},{1061:0.14164847892618948},{2443:0.04908439250929015},{2444:0.13852394074201585},{2445:0.19095041719265282},{925:0.09108963671400007},{1065:0.023077136537193985},{2736:0.09392926696597076},{2737:0.20228337137730884},{2738:0.17495521026574176},{2740:0.0383336465805769},{2739:0.13579319368171341},{2741:0.08976080172666998},{2742:0.1635369423678831},{2743:0.079748444724828},{2744:0.11577632616866719}];
        m.addLayer(new FM.layer({
            layers: 'fenix:gaul1_3857',
            layertitle: 'Rice Production Area',
            opacity: '0.7',
            joincolumn: joincolumn,
            joincolumnlabel: joincolumnlabel,
            joindata: data,
            mu: mu,
            measurementunit: mu,
            layertype: 'JOIN',
            jointype: 'shaded',
            intervals:9,
            openlegend: true,
            defaultgfi: true,
            colorramp: 'Greens',
            addborders:'true',
            borderscolor:'FFFFFF',
            bordersstroke:'0.9',
            bordersopacity:'0.4',
            lang: 'en',
            customgfi: {
                content: {
                    en: "<div class='fm-popup'>{{" + joincolumnlabel + "}} <div class='fm-popup-join-content'>{{{" + joincolumn + "}}} "+ mu +"</div></div>"
                },
                showpopup: true
            }
        }));

        m.addLayer( new FM.layer({
            layers: 'fenix:gaul0_line_3857',
            layertitle: 'Country Boundaries',
            urlWMS: 'http://fenixapps.fao.org/geoserver',
            opacity: '0.9',
            lang: 'en'
        }));
    };

    return FM_JOIN_GAUL1;
});