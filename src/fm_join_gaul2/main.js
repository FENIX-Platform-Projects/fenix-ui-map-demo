define(['jquery',
    'handlebars',
    'highcharts',
    'text!fm_join_gaul2/html/template.html',
    'fenix-map'], function ($, Handlebars, highcharts, template) {

    'use strict';

    function FM_JOIN_GAUL1() {
        this.o = {
            'lang': 'en',
            'placeholder': 'main_content'
        };
    }

    FM_JOIN_GAUL1.prototype.init = function(config) {
        this.o = $.extend(true, {}, this.o, config);
        var source = $(template).filter('#template').html();
        var t = Handlebars.compile(source);
        var html = t();
        $('#' + this.o.placeholder).html(html);

        // map
        var m = new FM.Map('map', {
            plugins: {
                geosearch: true,
                mouseposition: false,
                controlloading : true,
                zoomControl: 'bottomright'
            },
            guiController: {
                overlay: true,
                baselayer: true,
                wmsLoader: true
            },
            gui: {
                disclaimerfao: true
            }
        }, {
            zoomControl: false,
            attributionControl: false
        });
        m.createMap();
        m.map.fitBounds([[20.4632205963135, 97.3455867767334], [5.61052131652832, 105.639387130737]]);


        var joincolumnlabel = 'adm2_name';
        var joincolumn =  'adm2_code';
        var mu =  '&#37;';
        var data = [{26968:0.29099451899528506},{26993:0.2358226478099823},{26604:0.01275138184428215},{26962:0.29533369839191437},{26945:0.5263658761978149},{26469:0.18785587698221207},{26531:0.05517714023590088},{27053:0.1629580014074842},{27146:0.08598519737521808},{26584:0.2124267319838206},{26738:0.24484863877296448},{26453:0.31833820044994354},{27038:0.09006849676370621},{26882:0.41036443412303925},{26532:0.052250634878873825},{26682:0.49684590101242065},{26874:0.7170052081346512},{26454:0.420757457613945},{26893:0.6195365190505981},{26455:0.1809828206896782},{26930:0.2254033237695694},{26985:0.20505614578723907},{27062:0.48088501890500385},{26883:0.35009449124336245},{26895:0.7509150207042694},{26917:0.028478683903813362},{26918:0.028393015265464783},{26624:0.05819737131241709},{26939:0.01880860406284531},{27172:0.022038775529446348},{26470:0.14492455621560416},{26433:0.441110501686732},{26867:0.23842289547125498},{26700:0.24429073929786682},{26756:0.07386890612542629},{26434:0.3267345428466797},{26643:0.36267024278640747},{26969:0.38673000782728195},{26678:0.3989739269018173},{27072:0.024436114355921745},{27181:0.023749052236477535},{27073:0.017697804421186448},{26689:0.2147462765375773},{26990:0.09979597479104996},{26585:0.3850937287012736},{26725:0.5970428387324015},{27147:0.06386228557676077},{26929:0.3446943014860153},{27164:0.2155953221264537},{26825:0.27191001176834106},{27103:0.03291052482090891},{27074:0.008449240460653196},{26471:0.2942337393760681},{27182:0.018951124578182186},{26757:0.020310331498169236},{26572:0.071810449163119},{26661:0.4803174063563347},{27111:0.028399630760153134},{26533:0.08401628211140633},{27090:0.401514895260334},{26701:0.2880250886082649},{26787:0.14671552057067552},{26788:0.15634708851575851},{26789:0.13779664412140846},{26406:0.023266369476914406},{26855:0.18107718974351883},{27126:0.24727378459647298},{26868:0.21925992518663406},{26611:0.03823410506759371},{26644:0.24419409462383815},{27075:0.020577957620844245},{26494:0.0391050378481547},{27148:0.4561130702495575},{27076:0.023663650654877227},{26702:0.23916231095790863},{27039:0.11586261168122292},{26770:0.04335799689094225},{26383:0.31895830233891803},{26970:0.41352570056915283},{26884:0.10805359076369893},{26472:0.16229507539953505},{26947:0.5374358197053274},{26739:0.11778249804462705},{26740:0.11893024742603302},{26495:0.009329533428951566},{26848:0.12240319792181253},{26631:0.10060637723654509},{26516:0.1030085876584053},{26758:0.06136210883657137},{26849:0.04536750458646566},{26517:0.09209984044233958},{26662:0.4384327232837677},{26741:0.11697006225585938},{26771:0.028676144778728485},{26703:0.31288227438926697},{26931:0.1618904024362564},{27091:0.49984726309776306},{26496:0.06658476715286572},{26856:0.2583051025867462},{26586:0.21789416670799255},{26587:0.2463842717309793},{27092:0.5407048165798187},{26704:0.2558460103140937},{26726:0.4876270443201065},{26850:0.11882580816745758},{27063:0.3396629486232996},{26705:0.25360163014668685},{26573:0.04679518441359202},{26632:0.04436823888681829},{26906:0.054155209101736546},{27127:0.5333814322948456},{27064:0.6995352307955424},{26497:0.04937445744872093},{26498:0.042109154909849164},{26851:0.38842110335826874},{27065:0.7511536777019501},{26672:0.1743553765118122},{27128:0.7143785357475281},{27077:0.022120446898043156},{26671:0.31323058903217316},{26683:0.48657894134521484},{27173:0.03864054195582867},{26499:0.07056139688938856},{26612:0.05097740218043327},{26500:0.10410748980939388},{26463:0.8476243019104004},{27040:0.08389851357787848},{26501:0.033639179853101574},{26919:0.014329919940792024},{26549:0.3201677203178406},{26550:0.23890843987464905},{26706:0.26025675733884174},{27117:0.07381910728290678},{26742:0.08853397890925407},{26384:0.3876338005065918},{27033:0.9980285167694092},{26826:0.1726337991654873},{26484:0.03096162900328636},{26998:0.15457201562821865},{26473:0.17883017162481943},{26869:0.03912846071438657},{26707:0.23189890384674072},{26551:0.38150548934936523},{26684:0.4818461835384369},{27078:0.026735258288681507},{27118:0.08810636401176453},{27016:0.2976418137550354},{27017:0.40682701021432877},{26664:0.4186214506626129},{26727:0.5957968831062317},{27093:0.3668708115816116},{26924:0.005283690855971405},{26832:0.008569320353368918},{26474:0.11576851806603372},{26948:0.5116689950227737},{27079:0.024142490699887276},{27187:0.362045019865036},{26552:0.22654588023821512},{26708:0.2684306502342224},{26971:0.41108284890651703},{26743:0.092513807117939},{26563:0.40031776428222654},{26840:0.10814334824681282},{26940:0.015690734920402367},{26857:0.07292244862765074},{26485:0.015626660268753766},{26605:0.017495799499253433},{27112:0.04314749035984278},{26588:0.3057432547211647},{26553:0.3029716908931732},{26870:0.30809758603572845},{27129:0.23862185080846152},{27054:0.292026050388813},{27080:0.021304269414395095},{26963:0.3260343670845032},{26564:0.40056598782539365},{26565:0.12977677781600505},{26806:0.41827258467674255},{26606:0.03046615927347115},{26486:0.012737088021822274},{26645:0.21799573302268982},{26814:0.18358471989631653},{26646:0.3369121253490448},{26972:0.19476401805877686},{26710:0.18206674910404466},{26711:0.25932073295116426},{27130:0.1268456369638443},{26475:0.07580451543132465},{26476:0.235792338848114},{27188:0.5111287832260132},{27008:0.03789324685931206},{27131:0.43010974675416946},{27009:0.08602171465754509},{26841:0.18002087250351906},{27041:0.06823418289422989},{27018:0.4286192536354065},{26673:0.2675473466515541},{26436:0.4246352016925812},{27019:0.2784837856888771},{26518:0.15687312185764313},{26654:0.011198914652182297},{26833:0.004004879291945447},{26941:0.01576339267194271},{26613:0.1013456614067157},{26607:0.014190739952027798},{27055:0.32914604619145393},{26842:0.34453727304935455},{27082:0.04176409915089607},{26665:0.4599650576710701},{26834:0.007128315977752209},{26925:0.059259355440735816},{26589:0.29724955062071484},{27042:0.04046028479933739},{26437:0.4421116039156914},{26991:0.1605696827173233},{26728:0.22361834347248077},{26554:0.3273538649082184},{26920:0.018571264576166868},{27149:0.10285184106656484},{26973:0.17725458244482675},{26974:0.18569729384034872},{27150:0.10169294476509094},{27189:0.4015689492225647},{27115:0.00669368061547478},{26438:0.35862045797208947},{26541:0.03188434739907583},{27094:0.5540237724781036},{26807:0.8295213580131531},{26439:0.40425287187099457},{26647:0.17007145285606384},{26608:0.17641555269559225},{26542:0.03173460178077221},{27010:0.03742324747145176},{26566:0.33473092317581177},{27166:0.32260180190205573},{26745:0.11519164592027664},{26574:0.2359633967280388},{27174:0.2594505250453949},{26729:0.5347457379102707},{26926:0.00486516096862033},{26626:0.034227496227965906},{27190:0.3913206841264452},{26858:0.1419483780860901},{26859:0.1404998360408677},{26907:0.012641925568459556},{26385:0.44622355699539185},{26502:0.07280913889408111},{26503:0.013345493331805548},{26852:0.35191382467746735},{26519:0.2386897752682368},{26759:0.03037994522601366},{26520:0.11680688088138898},{26815:0.18533821403980255},{26655:0.010002704544199837},{26614:0.035269902708629765},{26615:0.04331453461199999},{27104:0.024155121482908725},{26504:0.027872776612639427},{26521:0.1167377345263958},{26656:0.007284732087282464},{27105:0.03239094994829169},{26522:0.08741582650691271},{26505:0.028593674302101135},{26616:0.08795355632901192},{26627:0.006290335499215871},{26506:0.020015792300303776},{26730:0.34110137533683044},{27191:0.436444416642189},{26488:0.014409095514565706},{26590:0.2528097952405612},{26464:0.936598002910614},{26817:0.1770983636379242},{26999:0.2696043401956558},{26386:0.42659249901771545},{26440:0.42357039120462203},{26457:0.2958863377571106},{26465:0.800528883934021},{26477:0.15997259505093098},{26507:0.07063725590705872},{26523:0.19658869815369448},{26543:0.026541676217069227},{26555:0.27107296884059906},{26567:0.3040209333101908},{26575:0.0443283294637998},{26591:0.2859526979071753},{26609:0.010148036759346724},{26617:0.08014710173010826},{26628:0.14360391721129417},{26633:0.0651605561375618},{26648:0.27216506376862526},{26657:0.015564606681436999},{26666:0.4085089365641276},{26674:0.29800471290946007},{26731:0.3687479794025421},{26679:0.32417099071400507},{26685:0.20160187780857086},{26690:0.1272355705499649},{26712:0.22099935511747995},{26746:0.07045978556076686},{26760:0.10142861425199291},{26772:0.032390531773368515},{26782:0.08267329840196504},{26790:0.2620730016912733},{26618:0.044549434818327426},{26835:0.009531001405169567},{26843:0.24700268109639487},{26853:0.21125750492016473},{26860:0.11520652978547982},{26875:0.5897753834724426},{26885:0.3726341823736827},{26908:0.17939898868401846},{26915:0.01462414301931858},{26827:0.33830990493297575},{26921:0.03314333657423655},{26927:0.00392826262395829},{26933:0.21034309267997742},{26942:0.014176578260958195},{26950:0.6240096688270569},{26964:0.20042488103111586},{26975:0.1829939070675108},{27133:0.39262768626213074},{26986:0.28344401717185974},{26992:0.07446379959583282},{27011:0.013725415617227555},{27021:0.507208801805973},{27056:0.2773497700691223},{27066:0.6601192355155945},{27083:0.026383206869165104},{27095:0.5165140827496847},{27106:0.05690526172984391},{27119:0.06385873444378376},{27116:0.029986325385315076},{27134:0.42489540576934814},{27151:0.09655843721702695},{27167:0.7639480233192444},{27175:0.24562201499938965},{27183:0.0345626026391983},{27192:0.390201735496521},{27135:0.36078914006551105},{26667:0.4974302053451538},{26828:0.15070230407374247},{26634:0.09141146093606949},{26668:0.4504452347755432},{26635:0.03716037459671497},{26691:0.190244326988856},{26686:0.43987777829170227},{26886:0.1626089287456125},{26783:0.07901690279444058},{27022:0.4972851574420929},{26861:0.06308371503837407},{26556:0.32096511125564575},{27176:0.048366078501567246},{26592:0.2972429431974888},{27153:0.045288565258185066},{26761:0.04062622731241087},{27137:0.30566176109843785},{26442:0.3807756185531616},{26762:0.03328705387603906},{27045:0.10309607349336147},{26692:0.23008142411708832},{26693:0.11485254392027855},{26490:0.02056934405118227},{27136:0.558763325214386},{27120:0.006154696457087994},{27152:0.03489948157221079},{26619:0.08667359198443592},{26976:0.27717551589012146},{26675:0.4650697708129883},{26887:0.2504836196700732},{26478:0.21339963376522064},{26443:0.2995590642094612},{26732:0.33117469400167465},{26479:0.08686282645378794},{26480:0.11761230044066906},{26716:0.29082585871219635},{27168:0.9520935118198395},{27156:0.0876733347773552},{26445:0.48672881722450256},{27002:0.36062389612197876},{27169:1.0429956912994385},{26446:0.4046427235007286},{26557:0.3417975977063179},{26649:0.3604765037695567},{26862:0.14094587974250317},{26952:0.4401165743668874},{26576:0.2048906870186329},{26593:0.3573742111523946},{26594:0.32669585198163986},{26810:0.6036204695701599},{26676:0.24689674377441406},{26872:0.058887116611003876},{27067:0.6839753091335297},{27023:0.5044518411159515},{27154:0.303913451731205},{27155:0.0334630124270916},{26784:0.07956182360649108},{26714:0.27308061718940735},{26715:0.23641310334205629},{26508:0.01443882978300711},{26680:0.07552894204854965},{26844:0.13932332769036293},{26524:0.13515904545783997},{26658:0.008743256553048816},{26636:0.08220834136009217},{26717:0.17175351402589253},{26447:0.46954818069934845},{26791:0.10560023412108421},{26748:0.07827283690373103},{26845:0.04013807326555252},{26681:0.5638557076454163},{26934:0.20157833769917488},{26718:0.24262099713087082},{27121:0.017347742803394794},{26659:0.013732069171965122},{26568:0.14568167924880981},{26629:0.1663956716656685},{26544:0.042624755203723906},{26953:0.5441061854362488},{26387:0.5623151361942291},{27193:0.34786179661750793},{26733:0.44699173739978243},{26481:0.08262445156772931},{26637:0.11948100104928017},{26525:0.2659655809402466},{26538:0.12523097395896912},{26977:0.29022441804409027},{26978:0.26679586867491406},{27084:0.010247069003526121},{26954:0.5010891854763031},{26458:0.40558648109436035},{26577:0.14702645026975208},{26545:0.018392083467915654},{26650:0.28301214054226875},{26669:0.4656183024247487},{26526:0.179312352091074},{27158:0.11449223244562745},{27138:0.403517742951711},{27159:0.10207781195640564},{27177:0.310705045859019},{26719:0.29078366855780285},{26749:0.0747477188706398},{26955:0.47599587837855023},{26595:0.3426389694213867},{26792:0.2638896902402242},{26979:0.15356456488370895},{26793:0.23377944342792034},{26694:0.2155601680278778},{26957:0.3740373452504476},{27107:0.03040066427950348},{26876:0.7523905038833618},{27139:0.2257072627544403},{26877:0.7811565846204758},{26935:0.21720806881785393},{26569:0.18936089922984442},{26509:0.01769285777118057},{27004:0.23446793854236603},{27085:0.01867893747985363},{26596:0.1457531899213791},{26888:0.421364963054657},{26448:0.4666741192340851},{26482:0.17506998280684152},{26638:0.07913620929632868},{26639:0.09645473770797253},{27086:0.02603200972080231},{26597:0.16416959464550018},{26640:0.04141690656542778},{27025:0.21625331416726112},{26449:0.4472966194152832},{26598:0.2182049857718604},{26734:0.37161999344825747},{26459:0.24659796059131622},{26610:0.01274782419204712},{26695:0.1116755207379659},{26943:0.019714974487821262},{26854:0.08116718364710157},{26491:0.011052603833377361},{26829:0.12827528733760118},{26450:0.45637059956789017},{26922:0.01620611298130825},{27026:0.4868968427181244},{27096:0.5189022533595562},{26720:0.28084249794483185},{26425:0.016141965985298157},{26763:0.06012022743622462},{27184:0.029469307977706194},{26773:0.038000342746575676},{27046:0.07616542093455791},{27027:0.4233201841513316},{27122:0.024733930826187134},{27097:0.4885571375489235},{27047:0.1047431044280529},{26910:0.09687664572681699},{26751:0.16089578717947006},{26774:0.03218607511371374},{27048:0.08041905363400777},{26651:0.22731243073940277},{27049:0.07998326553830079},{26559:0.2982478737831116},{27194:0.33456818759441376},{26570:0.383651040494442},{26578:0.017844706100573683},{27068:0.7633766233921051},{26878:0.6096014142036438},{27108:0.01610802316443167},{26510:0.01966190878301859},{27140:0.7170006334781647},{27098:0.5318003743886948},{26989:0.05678926408290863},{26461:0.40018948167562485},{27099:0.4712640233337879},{26579:0.016592268451032312},{26794:0.13287784593800703},{27160:0.07904164493083954},{26511:0.09024385176599026},{26466:0.9808154106140137},{26513:0.06795590661931783},{26467:0.9463745951652527},{26451:0.46730899810791016},{26395:0.8868785500526428},{27170:0.5920581420262655},{26980:0.3346979575497763},{27057:0.3069992810487747},{26546:0.027530689956620336},{26795:0.2572024737795194},{26958:0.46127697825431824},{26846:0.4885181188583374},{26785:0.07367679583174842},{26796:0.21520966291427612},{26600:0.12255811728537083},{26752:0.09099107421934605},{27123:0.026005262043327093},{26721:0.25551794634924996},{27101:0.5944535136222839},{26830:0.14936819672584534},{26831:0.25943106412887573},{27141:0.3627760708332062},{27051:0.07011428102850914},{27069:0.8223676681518555},{26540:0.03345383579532305},{27142:0.19924284294247627},{26775:0.03392232209444046},{27059:0.27374661564826963},{27060:0.14757251356624895},{26580:0.021338448885621294},{26959:0.546982616186142},{27161:0.11739608645439148},{26863:0.19327369332313538},{26797:0.27331916242837906},{26620:0.03441040581092238},{26722:0.1909035723656416},{26492:0.11431880867374795},{26560:0.2728893365710974},{26911:0.03858133214331853},{26981:0.29707033932209015},{26765:0.13196875403324762},{27070:0.5159376412630081},{26798:0.23097875341773033},{26660:0.01718932291906741},{26621:0.11580120508248608},{26697:0.2012356072664261},{26936:0.09093771657596032},{26776:0.04433457056681315},{26928:0.010425537824630737},{26778:0.031351618468761444},{26912:0.13351279310882092},{26723:0.2568210452795029},{26786:0.09771788616975148},{26960:0.46740541607141495},{26779:0.043921228498220444},{26735:0.5213768407702446},{26736:0.4530871093273163},{26836:0.00593718895688653},{26837:0.010625510942190886},{26847:0.3233979418873787},{27143:0.37502169609069824},{26982:0.10773118585348129},{26880:0.7480235695838928},{26965:0.21568221350510916},{26879:0.6736429929733276},{26799:0.24390575289726257},{27087:0.03155763000249863},{27088:0.01879597579439481},{27195:0.3870336711406708},{26838:0.009552148170769215},{26916:0.017936456948518753},{26641:0.027467055479064584},{26652:0.3002938777208328},{26493:0.0246717631816864},{26581:0.09868817403912544},{26582:0.06026851758360863},{27185:0.02197921520564705},{27012:0.029404405504465103},{27178:0.05523772618140687},{26839:0.007676105946302414},{26923:0.030279316008090973},{27171:1.0129817128181458},{26547:0.030952416732907294},{26753:0.0676977675408125},{27109:0.02587511103289823},{26462:0.29849999537691474},{26737:0.4872367935521262},{26699:0.22965119779109955},{27102:0.5171474814414978},{26698:0.10275811981409788},{26766:0.09552725031971931},{26961:0.5258880356947581},{26653:0.32667502760887146},{26873:0.17015389427542688},{27052:0.09950471296906471},{26483:0.12353893518447875},{26622:0.025401109152219513},{26527:0.14535925643784658},{26583:0.013123412302229553},{27179:0.14139071386307478},{26767:0.04048867772022883},{27162:0.27514514327049255},{26630:0.007585475221276283},{26571:0.41886313259601593},{27061:0.09237627126276493},{26754:0.1891225352883339},{26548:0.03676154091954231},{27013:0.09761722137530644},{26755:0.08878711331635714},{27144:0.40092078277042936},{26601:0.34705445170402527},{27110:0.021230575664398763},{27071:0.37221292157967883},{27029:0.46251288056373596},{26780:0.06651939451694489},{26602:0.32561567425727844},{26944:0.02042238476375739},{26913:0.049440743091205754},{27030:0.3864095211029053},{27006:0.3476453274488449},{26724:0.18585754558444023},{26966:0.25222807824611665},{26905:0.6727241277694702},{26623:0.07942556190703597},{26864:0.2641709465533495},{26881:0.6389906803766886},{27163:0.08211668208241463},{26642:0.10188264813688067},{26889:0.29382164229949315},{27124:0.0241253562271595},{26983:0.3281857594847679},{26670:0.5381767849127451},{27145:0.36065031339724857},{26984:0.3760187029838562},{26890:0.23126092659575598},{26468:0.8410820215940475},{26967:0.16734761968255044},{26528:0.19664085656404495},{26515:0.01425819587893784},{26529:0.09036780148744583},{26530:0.05926066585299042},{26768:0.04244603778546055},{27089:0.026727598160505295},{26865:0.1921533688902855},{27007:0.3448832035064697},{26396:1.0161843299865723},{27186:0.04268199045743261},{27031:0.5045315027236938},{26562:0.29087214668591815},{27125:0.01728138979524374}];

        m.addLayer(new FM.layer({
            layers: 'fenix:gaul2_3857',
            layertitle: 'Rice Production Area',
            opacity: '0.7',
            joincolumn: joincolumn,
            joincolumnlabel: joincolumnlabel,
            joindata: data,
            mu: mu,
            legendsubtitle: mu,
            layertype: 'JOIN',
            jointype: 'shaded',
            intervals:9,
            openlegend: true,
            defaultgfi: true,
            colorramp: 'RdPu',
            addborders:'true',
            borderscolor:'FFFFFF',
            bordersstroke:'0.1',
            bordersopacity:'0.7',
            lang: 'en',
            customgfi: {
                content: {
                    en: "<div class='fm-popup'>{{" + joincolumnlabel + "}} <div class='fm-popup-join-content'>{{{" + joincolumn + "}}} "+ mu +"</div></div>"
                },
                showpopup: true
            }
        }));

        m.addLayer( new FM.layer({
            layers: 'fenix:gaul0_line_3857',
            layertitle: 'Country Boundaries',
            urlWMS: 'http://fenixapps.fao.org/geoserver',
            opacity: '0.9',
            lang: 'en'
        }));
    };

    return FM_JOIN_GAUL1;
});